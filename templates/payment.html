{% extends "customer_base.html" %}

{% block title %}Payment | Pristine Veggies{% endblock %}

{% block content %}

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
    .container {
        max-width: 600px;
        margin: 60px auto;
        background: #ffffff;
        padding: 30px 35px;
        border-radius: 8px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        text-align: center;
    }

    h2 {
        color: #2e7d32;
        margin-bottom: 20px;
    }

    .details {
        font-size: 16px;
        margin-bottom: 15px;
        color: #333;
    }

    .amount {
        font-size: 18px;
        font-weight: bold;
        margin: 20px 0;
    }

    .pay-btn {
        padding: 14px 35px;
        background-color: #2e7d32;
        color: #ffffff;
        border: none;
        border-radius: 30px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.25s ease;
    }

    .pay-btn:hover {
        background-color: #1b5e20;
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0,0,0,0.25);
    }
</style>

<div class="container">

    <h2>Complete Payment</h2>

    <p class="details">
        <strong>Order ID:</strong> {{ order.ord_id }}
    </p>

    <p class="amount">
        Amount to Pay: ₹{{ order.ord_total_amount }}
    </p>

    <!-- ✅ Pay button (Razorpay opens ONLY when clicked) -->
    <button id="payBtn" class="pay-btn">
        Pay Now
    </button>

</div>

<!-- Razorpay submission form -->
<form id="razorpay-form" method="POST"
      action="{% url 'orders:confirm_payment' order.ord_id %}">
    {% csrf_token %}
    <input type="hidden" name="razorpay_payment_id" id="razorpay_payment_id">
    <input type="hidden" name="razorpay_order_id" id="razorpay_order_id">
    <input type="hidden" name="razorpay_signature" id="razorpay_signature">
</form>

<script>
    var options = {
        "key": "{{ razorpay_key }}",
        "amount": "{{ amount }}",
        "currency": "INR",
        "name": "Pristine Veggies",
        "description": "Order #{{ order.ord_id }}",
        "order_id": "{{ razorpay_order_id }}",

        "handler": function (response) {
            document.getElementById("razorpay_payment_id").value = response.razorpay_payment_id;
            document.getElementById("razorpay_order_id").value = response.razorpay_order_id;
            document.getElementById("razorpay_signature").value = response.razorpay_signature;

            document.getElementById("razorpay-form").submit();
        },

        "theme": {
            "color": "#2e7d32"
        }
    };

    var rzp = new Razorpay(options);

    // ✅ Razorpay opens ONLY when button is clicked
    document.getElementById("payBtn").onclick = function (e) {
        e.preventDefault();
        rzp.open();
    };
</script>

{% endblock %}
